{% extends "layout.html.twig" %}

  {% block title %}Offres d'emploi{% endblock %}


        {% block content %}

        <div class="col-md-12 text-center">
            <blockquote class="blockquote text-center" style="margin-top: 80px;"><h1>Offres d'emploi</h1> </blockquote>
        </div>

<div class="javascript"><a href="{{ path('formulaireemploi') }}"><button type="button" class="btn btn-info" style="margin-left:10px; width: 350px; margin-top:50px;">Poster une offre d'emploi</button></a></div>

{% if is_granted('IS_AUTHENTICATED_FULLY') %}
<a href="{{ path('updateJobAction', {id: app.user.id}) }}"><button type="button" class="btn btn-info" style="margin-left: 10px; margin-top: 10px; width: 350px;">Modifiez votre offre d'emploi</button></a>

{% endif %}

            <form method="GET" style='margin-top:20px;'>
            <input type="text" name="title" id="title" placeholder="Rentrer le nom de l'offre d'emploi"  style="margin-left:10px;">
            <button type="button" class="btn btn-info" id="action" style="margin-left:10px; width: 350px; ">Recherche d'une offre d'emploi par son titre</button>
            </form>

            <div id="result"></div>

            <form method="GET">
            <input type="text" name="city" id="city" placeholder="Rentrer une ville" style="margin-left:10px;">
            <button type="button" class="btn btn-info" id="action1" style="margin-left:10px; width: 350px;">Recherche d'offres d'emploi par ville</button>

            <div id="result"></div>

<table class="table table-striped" style="margin-left:10px; margin-top: 20px; width:1900px;">
  <thead>
    <tr>
      <th scope="col">Date de l'offre</th>
      <th scope="col">Poste</th>
      <th scope="col">Ville</th>
      <th scope="col">Détails</th>
      {% if is_granted('ROLE_ADMIN') %} <th scope="col">Modification</th>{%endif%}
     {% if is_granted('ROLE_ADMIN') %} <th scope="col">Suppression</th>{%endif%}
    </tr>
  </thead>
<tbody>
    <tr>
         {% for offre in offres %} 
        
      <td>{{ offre.date_offer }}</td>
      <td>{{ offre.title }}</td>
      <td>{{ offre.city }}</td>
        <td><div class="javascript"><a href="{{ path('detailoffre', {id:offre.id} ) }}">Détail du poste</a></div></td>
        {% if is_granted('ROLE_ADMIN') %}
         <td> <a href="{{ path('updateAdminOffreAction', {id: offre.id}) }}">Modifier cette offre</a> </td>
         <td> <a href="{{ path('deleteAdminOffreAction', {id: offre.id}) }}">Supprimer cette offre</a> </td>

                    {%endif%}
        
    </tr>

  {% endfor %} 

  </tbody>
</table>

    {% endblock %} 
                
    {% block javascript %}
               
    <script>
        $(function(){
            $('#action').click(function(event){
                //permet d'empêcher la validation du formulaire et le chargement de la page
                event.preventDefault();
                //construction de l'url de la requête avec les paramètres
                var url = "{{ path('rechercheajaxpartitre') }}";
                //requête ajax en GET
                $.ajax({
                    type: 'GET',
                    url: url,
                    data: $('form').serialize(),
                    dataType: 'html',
                    success: function(data){
                        $('#result').html(data);
                    },
                    error: function() {
                        alert('La requête n\'a pas abouti'); 
                    }
                });
            });
        });
    </script> 
<script>
        $(function(){
            $('#action1').click(function(event){
                //permet d'empêcher la validation du formulaire et le chargement de la page
                event.preventDefault();
                //construction de l'url de la requête avec les paramètres
                var url = "{{ path('rechercheajaxparville') }}";
                //requête ajax en GET
                $.ajax({
                    type: 'GET',
                    url: url,
                    data: $('form').serialize(),
                    dataType: 'html',
                    success: function(data){
                        $('#result').html(data);
                    },
                    error: function() {
                        alert('La requête n\'a pas abouti'); 
                    }
                });
            });
        });
    </script> 
    <script>
        {% if not is_granted('IS_AUTHENTICATED_FULLY') %}
        $('.javascript').click(function(){
          alert('Vous devez être connecté(e) pour accéder à cette page.');  
    });
         
         {% endif %}
    </script> 

{% endblock %}