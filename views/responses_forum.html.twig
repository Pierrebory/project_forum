{% extends "layout.html.twig" %}
	
	{% block title %}Un sujet{% endblock %}
	
	{% block content %}

<br><br>
<br><br><br>
       
           
        <h2 style="text-align: center">  {{ subject.title}}</h2>
        <article style="text-align: center; border: ridge;  background-color: #f5f5f5; align-items: center; margin-left: 40em; margin-right: 40em; margin-bottom: 2em; box-shadow: 6px 6px 6px #d6d5d5;   word-wrap: break-word">
                
				
				<img style="margin-top: 1em; margin-left: 1em; margin-right: 45em; padding-top: -1em;" src="{{ asset('img/avatar/web/uploads/' ~ subject.user_id.avatar) }}" class="img img-responsive img-rounded" width="75"><p style="margin-top: -2em;">Message publié le {{ subject.date_message }}
				par {{ subject.user_id.username }}</p><hr style="margin-left: 3em; margin-right: 3em; border: 0;
    height: 1px;
    background: #333;
    background-image: linear-gradient(to right, #ccc, #333, #ccc);">
                <p style="padding: 1em;">{{ subject.message }}</p>
			</article>

        
            {% for response in responses %}
			 <article style="text-align: center; border: ridge;  background-color: #f5f5f5; align-items: center; margin-left: 40em; margin-right: 40em; margin-bottom: 2em; box-shadow: 6px 6px 6px #d6d5d5;   word-wrap: break-word">
                
				
				<img style="margin-top: 1em; margin-left: 1em; margin-right: 45em" src="{{ asset('img/avatar/web/uploads/' ~ response.user_id.avatar) }}" class="img img-responsive img-rounded" width="75"><p style="margin-top: -2em;">Message publié le {{ response.date_message }}
				par {{ response.user_id.username }}</p><hr style="margin-left: 3em; margin-right: 3em; border: 0;
    height: 1px;
    background: #333;
    background-image: linear-gradient(to right, #ccc, #333, #ccc);">
                <p style="padding: 1em;">{{ response.message }}</p>
			</article>
        {%endfor%}

{{ form_start(responsesForm, { 'attr': {'class': 'form-horizontal'} }) }}
                <div class="form-group" style="margin-left: 25em; margin-right: 25em">
                    {{ form_label(responsesForm.message, null) }}
                    <div>
                        {%if not responsesForm.vars.valid %}
                    <div class="alert alert-danger">
                        {{ form_errors(responsesForm.message) }}
                    </div>
                        {%endif%}
                        {{ form_widget(responsesForm.message, { 'attr':  {
                            'class': 'form-control'
                        }}) }}
                    </div>
                </div>
                <br>
                <div class="form-group" class="col-sm-12" style="margin-left: 60em; margin-right: 60em">
                    <input type="submit" class="btn btn-primary btn-lg" id="action" value="Send" />
                </div><br>

<div id="result"></div>


            {{ form_end(responsesForm) }}

{% endblock %}


{% block javascript %}

             
   <script>
       $(function(){
           $('#action').click(function(event){
               //permet d'empêcher la validation du formulaire et le chargement de la page
               event.preventDefault();
               //construction de l'url de la requête avec les paramètres
               var url = "{{ path('responses') }}";
               
               $.ajax({
                   type: 'GET',
                   url: url,
                   data: $('form').serialize(),  
                   dataType: 'html',
                   success: function(data){
                       $('#result').html(data);
                   },
                   error: function() {
                       alert('La requête n\'a pas abouti');
                   }
               });
           });
       });
   </script> 

    

{% endblock %}